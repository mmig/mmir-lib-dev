!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.scionCoreLib=e():t.scionCoreLib=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var u,c=[],l=!1,f=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!l){var t=a(p);l=!0;for(var e=c.length;e;){for(u=c,c=[];++f<e;)u&&u[f].run();f=-1,e=c.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function y(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new h(t,e)),1!==c.length||l||a(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){t.exports={STATE_TYPES:{BASIC:0,COMPOSITE:1,PARALLEL:2,HISTORY:3,INITIAL:4,FINAL:5},SCXML_IOPROCESSOR_TYPE:"http://www.w3.org/TR/scxml/#SCXMLEventProcessor",HTTP_IOPROCESSOR_TYPE:"http://www.w3.org/TR/scxml/#BasicHTTPEventProcessor",RX_TRAILING_WILDCARD:/\.\*$/}},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(6),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(3))},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"===("undefined"==typeof window?"undefined":n(window))&&(r=window)}t.exports=r},function(t,e,n){t.exports=n(5)},function(t,e,n){(function(e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=s(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function s(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=p(t);if(e){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}function f(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=n(7),h=(d.helpers,d.query),y=d.helpers.transitionComparator,m=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(a,t);var e,n,r,s=l(a);function a(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=e||{}).legacySemantics=!1,s.call(this,t,e)}return e=a,(n=[{key:"_selectTransitions",value:function(t,e){var n,r=this.opts.transitionSelector,i=new this.opts.Set,s=this._evaluateAction.bind(this,t),a=o(this._configuration.iter().sort(y));try{for(a.s();!(n=a.n()).done;){var u,c=n.value,l=o([c].concat(h.getAncestors(c)));try{t:for(l.s();!(u=l.n()).done;){var f,p=o(u.value.transitions);try{for(p.s();!(f=p.n()).done;){var d=f.value;if(r(d,t,s,e)){i.add(d);break t}}}catch(t){p.e(t)}finally{p.f()}}}catch(t){l.e(t)}finally{l.f()}}}catch(t){a.e(t)}finally{a.f()}var m=this._removeConflictingTransition(i);return this._log("priorityEnabledTransitions",m),m}},{key:"_removeConflictingTransition",value:function(t){var e,n=this,r=new this.opts.Set,s=o(t.iter());try{for(s.s();!(e=s.n()).done;){var a,u=e.value,c=!1,l=new Set,f=o(r.iter());try{var p=function(){var t=a.value,e=n._computeExitSet([u]),r=n._computeExitSet([t]),o=i(e).some((function(t){return r.has(t)}))||i(r).some((function(t){return e.has(t)}));if(n._log("t1ExitSet",u.source.id,i(e).map((function(t){return t.id}))),n._log("t2ExitSet",t.source.id,i(r).map((function(t){return t.id}))),n._log("hasIntersection",o),o){if(!(t.source.descendants.indexOf(u.source)>-1))return c=!0,"break";l.add(t)}};for(f.s();!(a=f.n()).done&&"break"!==p(););}catch(t){f.e(t)}finally{f.f()}if(!c){var d,h=o(l);try{for(h.s();!(d=h.n()).done;){var y=d.value;r.remove(y)}}catch(t){h.e(t)}finally{h.f()}r.add(u)}}}catch(t){s.e(t)}finally{s.f()}return r}}])&&u(e.prototype,n),r&&u(e,r),a}(d.BaseInterpreter);d.Statechart=m,d.InterpreterScriptingContext.invokers={"http://www.w3.org/TR/scxml/":function(t,n,r,i){if(!n.constructorFunction)throw new Error("Invoke object needs a constructorFunction property");var o,s=n.constructorFunction,a={invokeid:n.id,params:n.params,parentSession:t,docUrl:n.docUrl},u=r;a.parentSession instanceof m&&(o=new m(s,a)),i(null,o,s,u),e((function(){return o.start()}))}},d.InterpreterScriptingContext.invokers[void 0]=d.InterpreterScriptingContext.invokers.null=d.InterpreterScriptingContext.invokers.scxml=d.InterpreterScriptingContext.invokers["http://www.w3.org/TR/scxml/"],t.exports=d}).call(this,n(2).setImmediate)},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,s,a,u=1,c={},l=!1,f=t.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(t);p=p&&p.setTimeout?p:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick((function(){h(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){h(t.data)},r=function(t){o.port2.postMessage(t)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,r=function(t){var e=f.createElement("script");e.onreadystatechange=function(){h(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(h,0,t)}:(s="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&h(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),r=function(e){t.postMessage(s+e,"*")}),p.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,r(u),u++},p.clearImmediate=d}function d(t){delete c[t]}function h(t){if(l)setTimeout(h,0,t);else{var e=c[t];if(e){l=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(e)}finally{d(t),l=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(3),n(0))},function(t,e,n){"use strict";(function(e,r){function i(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=a(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function o(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e,n){return e&&f(t.prototype,e),n&&f(t,n),t}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g(t);if(e){var i=g(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y(this,n)}}function y(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?m(t):e}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var v=n(8).EventEmitter,_=n(9),S=n(12),b=n(1),E=n(13),w=n(14),T=E.extend,x=E.transitionWithTargets,O=E.transitionComparator,A=E.initializeModel,k=(E.isEventPrefixMatch,E.isTransitionMatch,E.scxmlPrefixTransitionSelector),I=(E.eventlessTransitionSelector,E.getTransitionWithHigherSourceChildPriority),C=E.sortInEntryOrder,j=E.getStateWithHigherSourceChildPriority,P=E.initializeModelGeneratorFn,R=E.deserializeSerializedConfiguration,z=E.deserializeHistory,M=b.STATE_TYPES.BASIC,D=b.STATE_TYPES.COMPOSITE,L=b.STATE_TYPES.PARALLEL,F=b.STATE_TYPES.HISTORY,B=b.STATE_TYPES.INITIAL,$=b.STATE_TYPES.FINAL,U=b.SCXML_IOPROCESSOR_TYPE,N=void 0!==e&&!!e.env.DEBUG,H=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(a,e);var n=h(a);function a(e,r){var i;l(this,a),(i=n.call(this)).opts=r,i.opts.InterpreterScriptingContext=i.opts.InterpreterScriptingContext||Q,i._isStepping=!1,i._scriptingContext=i.opts.interpreterScriptingContext||(i.opts.InterpreterScriptingContext?new i.opts.InterpreterScriptingContext(m(i)):{}),i.opts.generateSessionid=i.opts.generateSessionid||a.generateSessionid,i.opts.sessionid=i.opts.sessionid||i.opts.generateSessionid(),i.opts.sessionRegistry=i.opts.sessionRegistry||a.sessionRegistry,i.opts.invokerExecutionContext=r.invokerExecutionContext||e._executionContext;var o,s={};if(s[U]={location:"#_scxml_".concat(i.opts.sessionid)},s.scxml=s[U],i.opts._x={_sessionid:i.opts.sessionid,_ioprocessors:s},"function"==typeof e)o=P(e,i.opts,m(i));else{if("object"!==c(e))throw new Error("Unexpected model type. Expected model factory function, or scjson object.");o=JSON.parse(JSON.stringify(e))}return i._model=A(o,i.opts),i.opts.console=i.opts.console||("undefined"==typeof console?{log:function(){}}:console),i.opts.Set=i.opts.Set||S,i.opts.priorityComparisonFn=i.opts.priorityComparisonFn||I,i.opts.transitionSelector=i.opts.transitionSelector||k,i.opts.sessionRegistry.set(String(i.opts.sessionid),m(i)),i._scriptingContext.log=i._scriptingContext.log||function(){this.opts.console.log.apply?this.opts.console.log.apply(this.opts.console,arguments):this.opts.console.log(Array.prototype.slice.apply(arguments).join(","))}.bind(m(i)),i._externalEventQueue=[],i._internalEventQueue=[],i.opts.params&&i._model.$deserializeDatamodel(i.opts.params),i.opts.snapshot?(i._configuration=new i.opts.Set(R(i.opts.snapshot[0],i._model.$idToStateMap)),i._historyValue=z(i.opts.snapshot[1],i._model.$idToStateMap),i._isInFinalState=i.opts.snapshot[2],i._model.$deserializeDatamodel(i.opts.snapshot[3]),i._internalEventQueue=i.opts.snapshot[4]):(i._configuration=new i.opts.Set,i._historyValue={},i._isInFinalState=!1),a.EVENTS.forEach((function(t){this.on(t,this._log.bind(this,t))}),m(i)),t.exports.emit("new",m(i)),i}return p(a,[{key:"cancel",value:function(){delete this.opts.parentSession,this._isInFinalState||(this._isInFinalState=!0,this._log("session cancelled ".concat(this.opts.invokeid)),this._exitInterpreter(null))}},{key:"_exitInterpreter",value:function(t){var e=this;this._cancelAllDelayedSends();for(var n=this._getFullConfiguration().sort(j),r=0,i=n.length;r<i;r++){var o=n[r];if(void 0!==o.onExit)for(var s=0,a=o.onExit.length;s<a;s++)for(var u=o.onExit[s],c=0,l=u.length;c<l;c++){var f=u[c];try{f.call(this._scriptingContext,null)}catch(t){this._handleError(t,f);break}}o.invokes&&o.invokes.forEach((function(t){e._scriptingContext.cancelInvoke(t.id)})),"final"===o.$type&&"scxml"===o.parent.$type&&(this.opts.parentSession&&this._scriptingContext.send({target:"#_parent",name:"done.invoke."+this.opts.invokeid,data:o.donedata&&o.donedata.call(this._scriptingContext,t)}),this.opts.sessionRegistry.delete(this.opts.sessionid),this.emit("onExitInterpreter",t))}}},{key:"start",value:function(){return this._initStart(),this._performBigStep(),this.getConfiguration()}},{key:"startAsync",value:function(t){t=this._initStart(t),this.genAsync(null,t)}},{key:"_initStart",value:function(t){var e=this;return"function"!=typeof t&&(t=Y),this._log("performing initial big step"),this._model.initialRef.forEach((function(t){return e._configuration.add(t)})),t}},{key:"getConfiguration",value:function(){return this._configuration.iter().map((function(t){return t.id}))}},{key:"_getFullConfiguration",value:function(){return this._configuration.iter().map((function(t){return[t].concat(w.getAncestors(t))}),this).reduce((function(t,e){return t.concat(e)}),[]).reduce((function(t,e){return t.indexOf(e)>-1?t:t.concat(e)}),[])}},{key:"getFullConfiguration",value:function(){return this._getFullConfiguration().map((function(t){return t.id}))}},{key:"isIn",value:function(t){return this.getFullConfiguration().indexOf(t)>-1}},{key:"isFinal",value:function(){return this._isInFinalState}},{key:"_performBigStep",value:function(t){var e,n,r,i,o=s(this._startBigStep(t),4);for(r=o[0],i=o[1],n=o[2],e=o[3];n;){var a=s(this._selectTransitionsAndPerformSmallStep(e,i,r),2);e=a[0],n=a[1]}this._finishBigStep(e,i,r)}},{key:"_selectTransitionsAndPerformSmallStep",value:function(t,e,n){var r=this._selectTransitions(t,!0);if(r.isEmpty()){var i=this._internalEventQueue.shift();i&&(t=i,r=this._selectTransitions(t,!1))}if(!r.isEmpty()){var o,a;this.emit("onSmallStepBegin",t);var u=s(this._performSmallStep(t,r),2);o=u[0],a=u[1],o&&o.forEach((function(t){return n.add(t)})),a&&a.forEach((function(t){return e.add(t)})),this.emit("onSmallStepEnd",t)}return[t,!r.isEmpty()||this._internalEventQueue.length]}},{key:"_startBigStep",value:function(t){var e=this;this.emit("onBigStepBegin",t),this._configuration.iter().forEach((function(n){n.invokes&&n.invokes.forEach((function(n){n.autoforward&&e._scriptingContext.send({target:"#_".concat(n.id),name:t.name,data:t.data}),n.id===t.invokeid&&n.finalize&&n.finalize.forEach((function(n){return e._evaluateAction(t,n)}))}))})),t&&this._internalEventQueue.push(t);var n=new Set;return[new Set,n,!0,t]}},{key:"_finishBigStep",value:function(t,e,n,r){var i=this;Array.from(new Set(o(e).filter((function(t){return t.invokes&&!n.has(t)})))).sort(C).forEach((function(e){e.invokes.forEach((function(e){return i._evaluateAction(t,e)}))})),n.forEach((function(t){t.invokes&&t.invokes.forEach((function(t){i._scriptingContext.cancelInvoke(t.id)}))})),this._isInFinalState=this._configuration.iter().every((function(t){return t.typeEnum===$})),this._isInFinalState&&this._exitInterpreter(t),this.emit("onBigStepEnd",t),r&&r(void 0,this.getConfiguration())}},{key:"_cancelAllDelayedSends",value:function(){var t,e=i(this._scriptingContext._timeouts);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.sendOptions.delay&&(this._log("cancelling delayed send",n),clearTimeout(n.timeoutHandle),this._scriptingContext._timeouts.delete(n))}}catch(t){e.e(t)}finally{e.f()}Object.keys(this._scriptingContext._timeoutMap).forEach((function(t){delete this._scriptingContext._timeoutMap[t]}),this)}},{key:"_performBigStepAsync",value:function(t,e){var n,i,o,a=s(this._startBigStep(t),4);i=a[0],o=a[1],a[2],n=a[3],function t(a){this.emit(a);var u=s(this._selectTransitionsAndPerformSmallStep(n,o,i),2);n=u[0],u[1]?(this.emit("onBigStepSuspend"),r(t.bind(this,"onBigStepResume"))):this._finishBigStep(n,o,i,e)}.call(this,"onBigStepBegin")}},{key:"_performSmallStep",value:function(t,e){var n,r;if(this._log("selecting transitions with currentEvent",t),this._log("selected transitions",e),!e.isEmpty()){var i=new this.opts.Set(e.iter().filter(x));n=this._exitStates(t,i),this._executeTransitions(t,e),r=this._enterStates(t,i),this._log("new configuration ",this._configuration)}return[n,r]}},{key:"_exitStates",value:function(t,e){var n,r=s(this._getStatesExited(e),2);r[0],n=r[1],this._log("exiting states");for(var o=0,a=n.length;o<a;o++){var u,c=n[o];if(c.isAtomic&&this._configuration.remove(c),this._log("exiting ",c.id),this.emit("onExit",c.id),void 0!==c.onExit)for(var l=0,f=c.onExit.length;l<f;l++)for(var p=c.onExit[l],d=0,h=p.length;d<h;d++){var y=p[d];try{y.call(this._scriptingContext,t)}catch(t){this._handleError(t,y);break}}if(c.historyRef){var m,g=i(c.historyRef);try{for(g.s();!(m=g.n()).done;){var v=m.value;u=v.isDeep?function(t){return t.typeEnum===M&&c.descendants.indexOf(t)>-1}:function(t){return t.parent===c},this._historyValue[v.id]=n.filter(u)}}catch(t){g.e(t)}finally{g.f()}}}return n}},{key:"_getStatesExited",value:function(t){for(var e=new this.opts.Set,n=new this.opts.Set,r=t.iter(),i=0,o=r.length;i<o;i++)for(var s=r[i].scope,a=s.descendants,u=this._configuration.iter(),c=0,l=u.length;c<l;c++){var f=u[c];if(a.indexOf(f)>-1){n.add(f),e.add(f);for(var p=w.getAncestors(f,s),d=0,h=p.length;d<h;d++)e.add(p[d])}}return[n,e.iter().sort(j)]}},{key:"_executeTransitions",value:function(t,e){var n=e.iter().sort(O);this._log("executing transitition actions");for(var r=0,i=n.length;r<i;r++){var o=n[r],s=o.targets&&o.targets.map((function(t){return t.id}));if(this.emit("onTransition",o.source.id,s,o.source.transitions.indexOf(o)),void 0!==o.onTransition)for(var a=0,u=o.onTransition.length;a<u;a++){var c=o.onTransition[a];try{c.call(this._scriptingContext,t)}catch(t){this._handleError(t,c);break}}}}},{key:"_enterStates",value:function(t,e){var n=this;this._log("entering states");var r=new Set,o=new Set,s={};this._computeEntrySet(e,r,o,s),r=Array.from(r).sort(C),this._log("statesEntered ",r);for(var a=0,u=r.length;a<u;a++){if((T=r[a]).isAtomic&&this._configuration.add(T),this._log("entering",T.id),this.emit("onEntry",T.id),void 0!==T.onEntry)for(var c=0,l=T.onEntry.length;c<l;c++)for(var f=T.onEntry[c],p=0,d=f.length;p<d;p++){var h=f[p];try{h.call(this._scriptingContext,t)}catch(t){this._handleError(t,h);break}}if(o.has(T)){var y,m=i(T.initialRef);try{for(m.s();!(y=m.n()).done;){var g=y.value;if(this.emit("onDefaultEntry",g.id),g.typeEnum===B){var v=g.transitions[0];if(void 0!==v.onTransition){this._log("executing initial transition content for initial state of parent state",T.id);for(var _=0,S=v.onTransition.length;_<S;_++){var b=v.onTransition[_];try{b.call(this._scriptingContext,t)}catch(t){this._handleError(t,b);break}}}}}}catch(t){m.e(t)}finally{m.f()}}if(s[T.id]){var E=s[T.id];if(void 0!==E.onTransition){this._log("executing history transition content for history state of parent state",T.id);for(_=0,S=E.onTransition.length;_<S;_++){var w=E.onTransition[_];try{w.call(this._scriptingContext,t)}catch(t){this._handleError(t,w);break}}}}}for(a=0,u=r.length;a<u;a++){var T;if((T=r[a]).typeEnum===$){var x=T.parent,O=x.parent;this._internalEventQueue.push({name:"done.state."+x.id,data:T.donedata&&T.donedata.call(this._scriptingContext,t)}),O&&O.typeEnum===L&&O.states.every((function(t){return n.isInFinalState(t)}))&&this._internalEventQueue.push({name:"done.state."+O.id})}}return r}},{key:"_getEffectiveTargetStates",value:function(t){var e,n=new Set,r=i(t.targets);try{for(r.s();!(e=r.n()).done;){var s=e.value;s.typeEnum===F?s.id in this._historyValue?this._historyValue[s.id].forEach((function(t){return n.add(t)})):o(this._getEffectiveTargetStates(s.transitions[0])).forEach((function(t){return n.add(t)})):n.add(s)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"_computeEntrySet",value:function(t,e,n,r){var o,s=i(t.iter());try{for(s.s();!(o=s.n()).done;){var a,u=o.value,c=i(u.targets);try{for(c.s();!(a=c.n()).done;){var l=a.value;this._addDescendantStatesToEnter(l,e,n,r)}}catch(t){c.e(t)}finally{c.f()}var f,p=u.scope,d=i(this._getEffectiveTargetStates(u));try{for(d.s();!(f=d.n()).done;){var h=f.value;this._addAncestorStatesToEnter(h,p,e,n,r)}}catch(t){d.e(t)}finally{d.f()}}}catch(t){s.e(t)}finally{s.f()}}},{key:"_computeExitSet",value:function(t){var e,n=new Set,r=i(t);try{for(r.s();!(e=r.n()).done;){var o=e.value;if(o.targets){var s,a=o.scope,u=i(this._getFullConfiguration());try{for(u.s();!(s=u.n()).done;){var c=s.value;w.isDescendant(c,a)&&n.add(c)}}catch(t){u.e(t)}finally{u.f()}}}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"_addAncestorStatesToEnter",value:function(t,e,n,r,s){var a,u=this,c=function(t){if(t.typeEnum===L){var e,a=i(t.states);try{var c=function(){var t=e.value;t.typeEnum===F||o(n).some((function(e){return w.isDescendant(e,t)}))||u._addDescendantStatesToEnter(t,n,r,s)};for(a.s();!(e=a.n()).done;)c()}catch(t){a.e(t)}finally{a.f()}}},l=i(w.getAncestors(t,e));try{for(l.s();!(a=l.n()).done;){var f=a.value;n.add(f),c(f)}}catch(t){l.e(t)}finally{l.f()}c(e)}},{key:"_addDescendantStatesToEnter",value:function(t,e,n,r){var s=this;if(t.typeEnum===F)if(this._historyValue[t.id]){var a,u=i(this._historyValue[t.id]);try{for(u.s();!(a=u.n()).done;){var c=a.value;this._addDescendantStatesToEnter(c,e,n,r)}}catch(t){u.e(t)}finally{u.f()}var l,f=i(this._historyValue[t.id]);try{for(f.s();!(l=f.n()).done;){var p=l.value;this._addAncestorStatesToEnter(p,t.parent,e,n,r)}}catch(t){f.e(t)}finally{f.f()}}else{r[t.parent.id]=t.transitions[0];var d,h=i(t.transitions[0].targets);try{for(h.s();!(d=h.n()).done;){var y=d.value;this._addDescendantStatesToEnter(y,e,n,r)}}catch(t){h.e(t)}finally{h.f()}var m,g=i(t.transitions[0].targets);try{for(g.s();!(m=g.n()).done;){var v=m.value;this._addAncestorStatesToEnter(v,t.parent,e,n,r)}}catch(t){g.e(t)}finally{g.f()}}else if(e.add(t),t.typeEnum===D){n.add(t);var _,S=i(t.initialRef);try{for(S.s();!(_=S.n()).done;){var b,E=_.value,T=i(E.typeEnum===B?E.transitions[0].targets:[E]);try{for(T.s();!(b=T.n()).done;){var x=b.value;this._addDescendantStatesToEnter(x,e,n,r)}}catch(t){T.e(t)}finally{T.f()}}}catch(t){S.e(t)}finally{S.f()}var O,A=i(t.initialRef);try{for(A.s();!(O=A.n()).done;){var k,I=O.value,C=i(I.typeEnum===B?I.transitions[0].targets:[I]);try{for(C.s();!(k=C.n()).done;){var j=k.value;this._addAncestorStatesToEnter(j,t,e,n,r)}}catch(t){C.e(t)}finally{C.f()}}}catch(t){A.e(t)}finally{A.f()}}else if(t.typeEnum===L){var P,R=i(t.states);try{var z=function(){var t=P.value;t.typeEnum===F||o(e).some((function(e){return w.isDescendant(e,t)}))||s._addDescendantStatesToEnter(t,e,n,r)};for(R.s();!(P=R.n()).done;)z()}catch(t){R.e(t)}finally{R.f()}}}},{key:"isInFinalState",value:function(t){var e=this;return t.typeEnum===D?t.states.some((function(t){return t.typeEnum===$&&e._configuration.contains(t)})):t.typeEnum===L&&t.states.every(this.isInFinalState.bind(this))}},{key:"_evaluateAction",value:function(t,e){try{return e.call(this._scriptingContext,t)}catch(t){this._handleError(t,e)}}},{key:"_handleError",value:function(t,e){var n=t instanceof Error||"string"==typeof t.__proto__.name&&t.__proto__.name.match(/^.*Error$/)?{name:"error.execution",data:{tagname:e.tagname,line:e.line,column:e.column,reason:t.message},type:"platform"}:t.name?t:{name:"error.execution",data:t,type:"platform"};this._internalEventQueue.push(n),this.emit("onError",n)}},{key:"_log",value:function(){if(N){var t=Array.from(arguments);this.opts.console.log("".concat(t[0],": ").concat(t.slice(1).map((function(t){return null===t?"null":void 0===t?"undefined":"string"==typeof t?t:"[object Object]"===t.toString()?_.inspect(t):t.toString()})).join(", "),"\n"))}}},{key:"registerListener",value:function(t){a.EVENTS.forEach((function(e){t[e]&&this.on(e,t[e])}),this)}},{key:"unregisterListener",value:function(t){a.EVENTS.forEach((function(e){t[e]&&this.off(e,t[e])}),this)}},{key:"getAllTransitionEvents",value:function(){var t={};return function e(n){if(n.transitions)for(var r=0,i=n.transitions.length;r<i;r++)t[n.transitions[r].event]=!0;if(n.states)for(var o=0,s=n.states.length;o<s;o++)e(n.states[o])}(this._model),Object.keys(t)}},{key:"getSnapshot",value:function(){return[this.getConfiguration(),this._serializeHistory(),this._isInFinalState,this._model.$serializeDatamodel(),this._internalEventQueue.slice()]}},{key:"_serializeHistory",value:function(){var t={};return Object.keys(this._historyValue).forEach((function(e){t[e]=this._historyValue[e].map((function(t){return t.id}))}),this),t}},{key:"gen",value:function(t,e){var n;switch(c(t)){case"string":n={name:t,data:e};break;case"object":if("string"!=typeof t.name)throw new Error('Event object must have "name" property of type string.');n=t;break;default:throw new Error("First argument to gen must be a string or object.")}if(this._isStepping)throw new Error("Cannot call gen during a big-step");return this._isStepping=!0,this._performBigStep(n),this._isStepping=!1,this.getConfiguration()}},{key:"genAsync",value:function(t,e){if(null!==t&&("object"!==c(t)||!t||"string"!=typeof t.name))throw new Error("Expected currentEvent to be null or an Object with a name");"function"!=typeof e&&(e=Y),this._externalEventQueue.push([t,e]),this._isStepping||(this._isStepping=!0,function t(e,n){this._performBigStepAsync(e,function(e,r){n(e,r),this._externalEventQueue.length?t.apply(this,this._externalEventQueue.shift()):this._isStepping=!1}.bind(this))}.apply(this,this._externalEventQueue.shift()))}}]),a}(v);function Y(){}H.EVENTS=["onEntry","onExit","onTransition","onDefaultEntry","onError","onBigStepBegin","onBigStepSuspend","onBigStepResume","onSmallStepBegin","onSmallStepEnd","onBigStepEnd","onExitInterpreter"],H.sessionIdCounter=1,H.generateSessionid=function(){return H.sessionIdCounter++},H.sessionRegistry=new Map;var Q=function(){function t(e){l(this,t),this._interpreter=e,this._timeoutMap={},this._invokeMap={},this._timeouts=new Set,this.validateUriRegex=/(#_.*)|\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/i,this.invokeSendTargetRegex=/^#_(.*)$/,this.scxmlSendTargetRegex=/^#_scxml_(.*)$/}return p(t,[{key:"raise",value:function(t){this._installDefaultPropsOnEvent(t,!0),this._interpreter._internalEventQueue.push(t)}},{key:"parseXmlStringAsDOM",value:function(e){return(this._interpreter.opts.xmlParser||t.xmlParser).parse(e)}},{key:"invoke",value:function(e){var n=this;this._invokeMap[e.id]=new Promise((function(r,i){(n._interpreter.opts.invokers||t.invokers)[e.type](n._interpreter,e,n._interpreter.opts.invokerExecutionContext,(function(t,e){if(t)return i(t);n._interpreter.emit("onInvokedSessionInitialized",e),r(e)}))}))}},{key:"cancelInvoke",value:function(t){var e=this,n=this._invokeMap[t];this._interpreter._log("cancelling session with invokeid ".concat(t)),n&&(this._interpreter._log("sessionPromise found"),n.then((function(n){e._interpreter._log("resolved session ".concat(t,". cancelling... ")),n.cancel(),delete e._invokeMap[t]}),(function(t){})))}},{key:"_installDefaultPropsOnEvent",value:function(t,e){e||(t.origin=this._interpreter.opts._x._ioprocessors.scxml.location,t.origintype=t.type||U),void 0===t.type&&(t.type=e?"internal":"external"),["name","sendid","invokeid","data","origin","origintype"].forEach((function(e){void 0===t[e]&&(t[e]=void 0)}))}},{key:"send",value:function(t,e){this._interpreter._log("send event",t,e);var n,r=(e=e||{}).type||U;n="https://github.com/jbeard4/SCION#publish"===t.type?function(){this._interpreter.emit(t.name,t.data)}:this._interpreter.opts.customSend?this._interpreter.opts.customSend:function(t,e){var n,r=this;if("undefined"==typeof setTimeout)throw new Error("Default implementation of BaseInterpreter.prototype.send will not work unless setTimeout is defined globally.");if("#_internal"===t.target)this.raise(t);else if(this._installDefaultPropsOnEvent(t,!1),t.origintype=U,t.target)if("#_parent"===t.target){if(!this._interpreter.opts.parentSession)throw{name:"error.communication",data:"Parent session not specified",sendid:t.sendid,type:"platform"};t.invokeid=this._interpreter.opts.invokeid,a.call(this,this._interpreter.opts.parentSession)}else if(n=t.target.match(this.scxmlSendTargetRegex)){var i=n[1],o=this._interpreter.opts.sessionRegistry.get(i);if(!o)throw{name:"error.communication",sendid:t.sendid,type:"platform"};a.call(this,o)}else{if(!(n=t.target.match(this.invokeSendTargetRegex)))throw new Error("Unrecognized send target.");var s=n[1];this._invokeMap[s].then((function(t){a.call(r,t)}))}else a.call(this,this._interpreter);function a(n){var r=setTimeout(function(){t.sendid&&delete this._timeoutMap[t.sendid],this._timeouts.delete(i),this._interpreter.opts.doSend?this._interpreter.opts.doSend(n,t):n[this._interpreter.opts.sendAsync?"genAsync":"gen"](t)}.bind(this),e.delay||0),i={sendOptions:e,timeoutHandle:r};t.sendid&&(this._timeoutMap[t.sendid]=r),this._timeouts.add(i)}},e=e||{},this._interpreter._log("sending event",t.name,"with content",t.data,"after delay",e.delay),function(t,e,n){if(t.target&&!this.validateUriRegex.test(t.target))throw{name:"error.execution",data:"Target is not valid URI",sendid:t.sendid,type:"platform"};if(r!==U)throw{name:"error.execution",data:"Unsupported event processor type",sendid:t.sendid,type:"platform"};n.call(this,t,e)}.call(this,t,e,n)}},{key:"cancel",value:function(t){if(this._interpreter.opts.customCancel)return this._interpreter.opts.customCancel.apply(this,[t]);if("undefined"==typeof clearTimeout)throw new Error("Default implementation of BaseInterpreter.prototype.cancel will not work unless setTimeout is defined globally.");t in this._timeoutMap&&(this._interpreter._log("cancelling ",t," with timeout id ",this._timeoutMap[t]),clearTimeout(this._timeoutMap[t]))}}]),t}();t.exports=T(new v,{BaseInterpreter:H,ArraySet:S,STATE_TYPES:b.STATE_TYPES,initializeModel:A,InterpreterScriptingContext:Q,helpers:E,query:w})}).call(this,n(0),n(2).setImmediate)},function(t,e){function n(){this._listeners={}}n.prototype.on=function(t,e){return Array.isArray(this._listeners[t])||(this._listeners[t]=[]),-1===this._listeners[t].indexOf(e)&&this._listeners[t].push(e),this},n.prototype.once=function(t,e){var n=this;function r(){for(var i=[],o=0;o<arguments.length;o+=1)i[o]=arguments[o];n.off(t,r),e.apply(n,i)}return r.listener=e,this.on(t,r)},n.prototype.off=function(t,e){if(!Array.isArray(this._listeners[t]))return this;if(void 0===e)return this._listeners[t]=[],this;var n=this._listeners[t].indexOf(e);if(-1===n)for(var r=0;r<this._listeners[t].length;r+=1)if(this._listeners[t][r].listener===e){n=r;break}return this._listeners[t].splice(n,1),this},n.prototype.emit=function(t){if(!Array.isArray(this._listeners[t]))return this;for(var e=[],n=1;n<arguments.length;n+=1)e[n-1]=arguments[n];return this._listeners[t].forEach((function(t){t.apply(this,e)}),this),this},t.exports.EventEmitter=n},function(t,e,n){(function(t){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=Object.getOwnPropertyDescriptor(t,e[r]);return n},o=/%[sdj%]/g;e.format=function(t){if(!v(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(u(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,i=r.length,s=String(t).replace(o,(function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}})),a=r[n];n<i;a=r[++n])m(a)||!b(a)?s+=" "+a:s+=" "+u(a);return s},e.deprecate=function(n,r){if(void 0!==t&&!0===t.noDeprecation)return n;if(void 0===t)return function(){return e.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var s,a={};function u(t,n){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),y(n)?r.showHidden=n:n&&e._extend(r,n),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),f(r,t,r.depth)}function c(t,e){var n=u.styles[e];return n?"["+u.colors[n][0]+"m"+t+"["+u.colors[n][1]+"m":t}function l(t,e){return t}function f(t,n,r){if(t.customInspect&&n&&T(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,t);return v(i)||(i=f(t,i,r)),i}var o=function(t,e){if(_(e))return t.stylize("undefined","undefined");if(v(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(g(e))return t.stylize(""+e,"number");if(y(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,n);if(o)return o;var s=Object.keys(n),a=function(t){var e={};return t.forEach((function(t,n){e[t]=!0})),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(n)),w(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return p(n);if(0===s.length){if(T(n)){var u=n.name?": "+n.name:"";return t.stylize("[Function"+u+"]","special")}if(S(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return t.stylize(Date.prototype.toString.call(n),"date");if(w(n))return p(n)}var c,l="",b=!1,x=["{","}"];(h(n)&&(b=!0,x=["[","]"]),T(n))&&(l=" [Function"+(n.name?": "+n.name:"")+"]");return S(n)&&(l=" "+RegExp.prototype.toString.call(n)),E(n)&&(l=" "+Date.prototype.toUTCString.call(n)),w(n)&&(l=" "+p(n)),0!==s.length||b&&0!=n.length?r<0?S(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),c=b?function(t,e,n,r,i){for(var o=[],s=0,a=e.length;s<a;++s)I(e,String(s))?o.push(d(t,e,n,r,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(d(t,e,n,r,i,!0))})),o}(t,n,r,a,s):s.map((function(e){return d(t,n,r,a,e,b)})),t.seen.pop(),function(t,e,n){if(t.reduce((function(t,e){return e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(c,l,x)):x[0]+l+x[1]}function p(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,n,r,i,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(a=t.stylize("[Setter]","special")),I(r,i)||(s="["+i+"]"),a||(t.seen.indexOf(u.value)<0?(a=m(n)?f(t,u.value,null):f(t,u.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),_(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function h(t){return Array.isArray(t)}function y(t){return"boolean"==typeof t}function m(t){return null===t}function g(t){return"number"==typeof t}function v(t){return"string"==typeof t}function _(t){return void 0===t}function S(t){return b(t)&&"[object RegExp]"===x(t)}function b(t){return"object"===r(t)&&null!==t}function E(t){return b(t)&&"[object Date]"===x(t)}function w(t){return b(t)&&("[object Error]"===x(t)||t instanceof Error)}function T(t){return"function"==typeof t}function x(t){return Object.prototype.toString.call(t)}function O(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(n){if(_(s)&&(s=t.env.NODE_DEBUG||""),n=n.toUpperCase(),!a[n])if(new RegExp("\\b"+n+"\\b","i").test(s)){var r=t.pid;a[n]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",n,r,t)}}else a[n]=function(){};return a[n]},e.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=h,e.isBoolean=y,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=g,e.isString=v,e.isSymbol=function(t){return"symbol"===r(t)},e.isUndefined=_,e.isRegExp=S,e.isObject=b,e.isDate=E,e.isError=w,e.isFunction=T,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"===r(t)||void 0===t},e.isBuffer=n(10);var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function k(){var t=new Date,e=[O(t.getHours()),O(t.getMinutes()),O(t.getSeconds())].join(":");return[t.getDate(),A[t.getMonth()],e].join(" ")}function I(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",k(),e.format.apply(e,arguments))},e.inherits=n(11),e._extend=function(t,e){if(!e||!b(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t};var C="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function j(t,e){if(!t){var n=new Error("Promise was rejected with a falsy value");n.reason=t,t=n}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(C&&t[C]){var e;if("function"!=typeof(e=t[C]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,C,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,n,r=new Promise((function(t,r){e=t,n=r})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(t,r){t?n(t):e(r)}));try{t.apply(this,i)}catch(t){n(t)}return r}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),C&&Object.defineProperty(e,C,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,i(t))},e.promisify.custom=C,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,s=function(){return i.apply(o,arguments)};e.apply(this,n).then((function(e){t.nextTick(s,null,e)}),(function(e){t.nextTick(j,e,s)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.defineProperties(n,i(e)),n}}).call(this,n(0))},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function(t){return t&&"object"===n(t)&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){function n(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,s=!0,a=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t){t=t||[],this.o=new Set(t)}i.prototype={add:function(t){this.o.add(t)},remove:function(t){return this.o.delete(t)},union:function(t){var e,r=n(t.o);try{for(r.s();!(e=r.n()).done;){var i=e.value;this.o.add(i)}}catch(t){r.e(t)}finally{r.f()}return this},difference:function(t){var e,r=n(t.o);try{for(r.s();!(e=r.n()).done;){var i=e.value;this.o.delete(i)}}catch(t){r.e(t)}finally{r.f()}return this},contains:function(t){return this.o.has(t)},iter:function(){return Array.from(this.o)},isEmpty:function(){return!this.o.size},size:function(){return this.o.size},equals:function(t){if(this.o.size!==t.size())return!1;var e,r=n(this.o);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(!t.contains(i))return!1}}catch(t){r.e(t)}finally{r.f()}return!0},toString:function(){return 0===this.o.size?"<empty>":Array.from(this.o).join(",\n")}},t.exports=i},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=n(1),o=i.STATE_TYPES,s=i.RX_TRAILING_WILDCARD;function a(t,e){return(t=t.replace(s,""))===e||!(t.length>e.length)&&("."===e.charAt(t.length)&&0===e.indexOf(t))}function u(t,e){return t.events.some((function(t){return"*"===t||a(t,e)}))}function c(t,e){return t.depth>e.depth?-1:t.depth<e.depth||t.documentOrder<e.documentOrder?1:t.documentOrder>e.documentOrder?-1:0}t.exports={extend:function(t,e){return Object.keys(e).forEach((function(n){t[n]=e[n]})),t},transitionWithTargets:function(t){return t.targets},transitionComparator:function(t,e){return t.documentOrder-e.documentOrder},initializeModel:function(t,e){var n=[],i=new Map,s=0,a={};var u=[];function c(t){if(!t.initialRef)throw new Error("Unable to locate initial state for composite state: "+t.id)}var l=/\s+/;function f(t){var e="internal"===t.type&&t.source.typeEnum===o.COMPOSITE&&t.source.parent&&t.targets&&t.targets.every((function(e){return t.source.descendants.indexOf(e)>-1}));return t.targets?e?t.source:t.lcca:null}function p(t,n){for(var r=[],i=0,s=t.ancestors.length;i<s;i++){var a=t.ancestors[i];(e&&e.legacySemantics?a.typeEnum===o.COMPOSITE:a.typeEnum===o.COMPOSITE||a.typeEnum===o.PARALLEL)&&a.descendants.indexOf(n)>-1&&r.push(a)}if(!r.length)throw new Error("Could not find LCA for states.");return r[0]}!function t(e){if(e.id&&i.set(e.id,e),e.states)for(var n=0,r=e.states.length;n<r;n++)t(e.states[n])}(t);var d=(h=t,{$deserializeDatamodel:h.$deserializeDatamodel||function(){},$serializeDatamodel:h.$serializeDatamodel||function(){return null},$idToStateMap:i,docUrl:h.docUrl,name:h.name,states:[{$type:"initial",transitions:[{target:h}]},h]});var h;return function t(e,r){0;r.transitions&&n.push.apply(n,r.transitions);r.$type=r.$type||"state",r.ancestors=e,r.depth=e.length,r.parent=e[0],r.documentOrder=s++,r.transitions=r.transitions||[];for(var l=0,f=r.transitions.length;l<f;l++){var p=r.transitions[l];p.documentOrder=s++,p.source=r}if(r.states){var d=[r].concat(e);for(l=0,f=r.states.length;l<f;l++)t(d,r.states[l])}switch(r.$type){case"parallel":r.typeEnum=o.PARALLEL,r.isAtomic=!1;break;case"initial":r.typeEnum=o.INITIAL,r.isAtomic=!0;break;case"history":r.typeEnum=o.HISTORY,r.isAtomic=!0;break;case"final":r.typeEnum=o.FINAL,r.isAtomic=!0;break;case"state":case"scxml":r.states&&r.states.length?(r.typeEnum=o.COMPOSITE,r.isAtomic=!1):(r.typeEnum=o.BASIC,r.isAtomic=!0);break;default:throw new Error("Unknown state type: "+r.$type)}r.states?r.descendants=r.states.concat(r.states.map((function(t){return t.descendants})).reduce((function(t,e){return t.concat(e)}),[])):r.descendants=[];var h;r.typeEnum===o.COMPOSITE&&(Array.isArray(r.initial)||"string"==typeof r.initial?u.push(r):(h=r.states.filter((function(t){return"initial"===t.$type})),r.initialRef=[h.length?h[0]:r.states[0]],c(r)));if(r.typeEnum===o.COMPOSITE||r.typeEnum===o.PARALLEL){var y=r.states.filter((function(t){return"history"===t.$type}));r.historyRef=y}r.id||(r.id=function(t){void 0===a[t]&&(a[t]=0);do{var e=a[t]++,n="$generated-"+t+"-"+e}while(i.has(n));return n}(r.$type),i.set(r.id,r));["onEntry","onExit"].forEach((function(t){r[t]&&(Array.isArray(r[t])||(r[t]=[r[t]]),r[t].every((function(t){return Array.isArray(t)}))||(r[t]=[r[t]]))})),r.invokes&&!Array.isArray(r.invokes)&&(r.invokes=[r.invokes],r.invokes.forEach((function(t){t.finalize&&!Array.isArray(t.finalize)&&(t.finalize=[t.finalize])})))}([],d),function(){for(var t=0,e=n.length;t<e;t++){if((s=n[t]).onTransition&&!Array.isArray(s.onTransition)&&(s.onTransition=[s.onTransition]),"string"==typeof s.event&&(s.events=s.event.trim().split(l)),delete s.event,!s.targets&&void 0!==s.target)if("string"==typeof s.target){var o=i.get(s.target);if(!o)throw new Error("Unable to find target state with id "+s.target);s.target=o,s.targets=[s.target]}else if(Array.isArray(s.target))s.targets=s.target.map((function(t){if("string"==typeof t){if(!(t=i.get(t)))throw new Error("Unable to find target state with id "+s.target);return t}return t}));else{if("object"!==r(s.target))throw new Error("Transition target has unknown type: "+s.target);s.targets=[s.target]}}for(t=0,e=n.length;t<e;t++){var s;(s=n[t]).targets&&(s.lcca=p(s.source,s.targets[0])),s.scope=f(s)}}(),function(){for(var t=0,e=u.length;t<e;t++){var n=u[t],r=Array.isArray(n.initial)?n.initial:[n.initial];n.initialRef=r.map((function(t){return i.get(t)})),c(n)}}(),d},isEventPrefixMatch:a,isTransitionMatch:u,scxmlPrefixTransitionSelector:function(t,e,n,r){return(r?!t.events:t.events&&e&&e.name&&u(t,e.name))&&(!t.cond||n(t.cond))},eventlessTransitionSelector:function(t){return t.transitions.filter((function(t){return!t.events||t.events&&0===t.events.length}))},getTransitionWithHigherSourceChildPriority:function(t){var e=t[0],n=t[1];c(e.source,n.source);return e.source.depth<n.source.depth?n:n.source.depth<e.source.depth||e.documentOrder<n.documentOrder?e:n},sortInEntryOrder:function(t,e){return-1*c(t,e)},getStateWithHigherSourceChildPriority:c,initializeModelGeneratorFn:function(t,e,n){return t.call(n,e._x,e._x._sessionid,e._x._ioprocessors,n.isIn.bind(n))},deserializeSerializedConfiguration:function(t,e){return t.map((function(t){var n=e.get(t);if(!n)throw new Error("Error loading serialized configuration. Unable to locate state with id "+t);return n}))},deserializeHistory:function(t,e){var n={};return Object.keys(t).forEach((function(r){n[r]=t[r].map((function(t){var n=e.get(t);if(!n)throw new Error("Error loading serialized history. Unable to locate state with id "+t);return n}))})),n}}},function(t,e,n){var r=n(1),i={isDescendant:function(t,e){return e.descendants.indexOf(t)>-1},getAncestors:function(t,e){var n;return(n=t.ancestors.indexOf(e))>-1?t.ancestors.slice(0,n):t.ancestors},isOrthogonalTo:function(t,e){return!this.isAncestrallyRelatedTo(t,e)&&this.getLCA(t,e).typeEnum===r.STATE_TYPES.PARALLEL},isAncestrallyRelatedTo:function(t,e){return this.getAncestorsOrSelf(e).indexOf(t)>-1||this.getAncestorsOrSelf(t).indexOf(e)>-1},getAncestorsOrSelf:function(t,e){return[t].concat(i.getAncestors(t,e))},getDescendantsOrSelf:function(t){return[t].concat(t.descendants)},getLCA:function(t,e){return this.getAncestors(t).filter((function(t){return t.descendants.indexOf(e)>-1}),this)[0]}};t.exports=i}])}));
//# sourceMappingURL=scion-core-lib.min.js.map